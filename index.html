<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Project Management System</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />

<!-- SUPABASE (LOAD ONCE ONLY) -->
<script src="https://unpkg.com/@supabase/supabase-js@2"></script>
<script>
  const supabaseClient = supabase.createClient(
    "https://saofwvouwqphxgvpsobt.supabase.co",
    "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNhb2Z3dm91d3FwaHhndnBzb2J0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA2MzUwNDAsImV4cCI6MjA4NjIxMTA0MH0.gK60J0yzYiCjyxfsXc5fAmTXnEi8rudER44X6z7ss-0"
  );
</script>

<style>
body {
  font-family: Arial, sans-serif;
  background: #f2f4f7;
  margin: 0;
  padding: 20px;
}
h1 { margin: 0 0 10px; }
button {
  padding: 10px 14px;
  border: none;
  border-radius: 4px;
  cursor: pointer;
}
.btn-primary { background: #0d6efd; color: #fff; }
.btn-danger { background: #dc3545; color: #fff; }
.btn-secondary { background: #6c757d; color: #fff; }
.card {
  background: #fff;
  border-radius: 6px;
  padding: 16px;
  margin-bottom: 14px;
  border-left: 6px solid #0d6efd;
}
.hidden { display: none; }
input, select {
  width: 100%;
  padding: 8px;
  margin-bottom: 10px;
}
.topbar {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 20px;
}
</style>
</head>

<body>

<!-- LOGIN -->
<div id="login">
  <h1>Login</h1>
  <select id="role">
    <option value="ceo">CEO</option>
    <option value="manager">Manager</option>
  </select>
  <button class="btn-primary" onclick="login()">Login</button>
</div>

<!-- CEO -->
<div id="ceo" class="hidden">
  <div class="topbar">
    <h1>CEO Dashboard</h1>
    <button class="btn-secondary" onclick="logout()">Logout</button>
  </div>
  <p id="noProjectsMessage" class="hidden" style="color:red;">No Available Projects.</p>
  <div id="ceoProjects"></div>
</div>

<!-- MANAGER -->
<div id="manager" class="hidden">
  <div class="topbar">
    <h1>Manager Dashboard</h1>
    <button class="btn-secondary" onclick="logout()">Logout</button>
  </div>

  <div id="managerProjects"></div>
  <button class="btn-primary" onclick="openCreate()">Create Project</button>
</div>

<!-- PROJECT FORM -->
<div id="projectForm" class="hidden">
  <h2 id="formTitle">Create Project</h2>

  <input id="pName" placeholder="Project Name (required)" />
  <input id="pLocation" placeholder="Location" />
  <input id="pBudget" type="number" placeholder="Budget" />
  <input id="pStart" type="date" />
  <input id="pTarget" type="date" />
  <input id="pStatus" placeholder="Status" />

  <button class="btn-primary" onclick="saveProject()">Save</button>
  <button class="btn-secondary" onclick="closeForm()">Cancel</button>
</div>

<script>
let editId = null;

/* ===== TEMP LOCAL STORAGE (SAFE BASELINE) ===== */
function getProjects() {
  return JSON.parse(localStorage.getItem("projects") || "[]");
}
function saveProjects(data) {
  localStorage.setItem("projects", JSON.stringify(data));
}

/* ===== AUTH ===== */
function login() {
  localStorage.setItem("role", role.value);
  render();
}
function logout() {
  localStorage.removeItem("role");
  location.reload();
}

 const login = document.getElementById("login");
const ceo = document.getElementById("ceo");
const manager = document.getElementById("manager");
const expediter = document.getElementById("expediter");
const projectForm = document.getElementById("projectForm");


<script>
function render() {
  const login = document.getElementById("login");
  const ceo = document.getElementById("ceo");
  const manager = document.getElementById("manager");
  const expediter = document.getElementById("expediter");
  const projectForm = document.getElementById("projectForm");

  const sections = [login, ceo, manager, expediter, projectForm];

  // hide everything safely
  sections.forEach(el => {
    if (el) el.classList.add("hidden");
  });

  const role = localStorage.getItem("role");

  // ✅ NO ROLE → SHOW LOGIN
  if (!role) {
    if (login) login.classList.remove("hidden");
    return;
  }

  // ✅ ROLE EXISTS → SHOW DASHBOARD
  if (role === "CEO" && ceo) ceo.classList.remove("hidden");
  if (role === "Manager" && manager) manager.classList.remove("hidden");
  if (role === "Expediter" && expediter) expediter.classList.remove("hidden");
}
</script>


function renderCEO() {
  const list = ceoProjects;
  const msg = noProjectsMessage;
  const projects = getProjects();

  list.innerHTML = "";
  if (projects.length === 0) {
    msg.classList.remove("hidden");
    return;
  }
  msg.classList.add("hidden");

  projects.forEach(p => {
    list.innerHTML += `
      <div class="card">
        <strong>${p.name}</strong><br>
        Location: ${p.location || "-"}<br>
        Budget: ${p.budget || "-"}<br>
        Start: ${p.start || "-"}<br>
        Target: ${p.target || "-"}<br>
        Status: ${p.status || "-"}
      </div>`;
  });
}

function renderManager() {
  managerProjects.innerHTML = "";
  getProjects().forEach(p => {
    managerProjects.innerHTML += `
      <div class="card">
        <strong>${p.name}</strong><br>
        Location: ${p.location || "-"}<br>
        Budget: ${p.budget || "-"}<br>
        Status: ${p.status || "-"}<br><br>
        <button class="btn-secondary" onclick="editProject('${p.id}')">Edit</button>
        <button class="btn-danger" onclick="deleteProject('${p.id}')">Delete</button>
      </div>`;
  });
}

/* ===== CRUD ===== */
function openCreate() {
  editId = null;
  formTitle.innerText = "Create Project";
  projectForm.classList.remove("hidden");
}

function editProject(id) {
  const p = getProjects().find(x => x.id === id);
  editId = id;
  formTitle.innerText = "Edit Project";
  pName.value = p.name;
  pLocation.value = p.location;
  pBudget.value = p.budget;
  pStart.value = p.start;
  pTarget.value = p.target;
  pStatus.value = p.status;
  projectForm.classList.remove("hidden");
}

function saveProject() {
  if (!pName.value.trim()) {
    alert("Project name required");
    return;
  }

  const projects = getProjects();
  if (editId) {
    Object.assign(projects.find(p => p.id === editId), collect());
  } else {
    projects.push({ id: Date.now().toString(), ...collect() });
  }
  saveProjects(projects);
  closeForm();
  render();
}

function collect() {
  return {
    name: pName.value,
    location: pLocation.value,
    budget: pBudget.value,
    start: pStart.value,
    target: pTarget.value,
    status: pStatus.value
  };
}

function deleteProject(id) {
  saveProjects(getProjects().filter(p => p.id !== id));
  render();
}

function closeForm() {
  projectForm.classList.add("hidden");
  pName.value = pLocation.value = pBudget.value =
  pStart.value = pTarget.value = pStatus.value = "";
}

render();
</script>

</body>
</html>
